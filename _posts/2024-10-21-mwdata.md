---
layout: post
title: "Milkyway 数据库应用说明"
date:   2024-10-21
tags: [physical design]
comments: true
author: Shuhao
---

本文档是 Milkyway™ Database Application Note Version J-2014.09, September 2014 的中文翻译版本，旨在为中文用户提供更易于理解的物理设计学习资料，如有翻译不当的地方，欢迎发送邮件进行指正。

<h2 id="1.">1. Milkyway 数据库</h2>

Milkyway 数据库是 Synopsys Galaxy™ 设计平台的统一设计存储格式。该数据库提供物理设计数据的持久存储，将 Galaxy 平台工具连接在一起。数据库会定期更新新功能，以支持 EDA 技术的进步。

Milkyway 数据库的基本特性将在以下部分中描述：

* [1.1 Milkyway 数据库概述](#1.1)

* [1.2 Milkyway 数据库的版本](#1.2)

* [1.3 Milkyway 库和单元](#1.3)

* [1.4 Milkyway 相关命令](#1.4)

* [1.5 物理库数据准备](#1.5)

* [1.6 数据库命名规则](#1.6)

<h3 id="1.1">1.1 Milkyway 数据库概述</h3>

Milkyway 数据库是 Synopsys Galaxy 设计平台的统一设计存储格式。该数据库提供持久的数据存储，将 Galaxy 平台工具连接在一起，从而消除了大型中间交换文件的需求，并防止了使用其他数据交换格式可能导致的设计意图丢失。Milkyway 数据库格式定期增加新功能，以支持工具特性，如信号完整性分析、功耗降低和良率提升。

Milkyway 数据库提供以下特性和优势：

- 经过生产验证的数据库，适用于所有 Galaxy 设计平台工具
- 支持最大规模的设计
- 支持最新的技术节点，包括 28 nm、20 nm、14 nm 及更先进的节点
- 通过 LEF 和 DEF 实现第三方数据输入到 Galaxy 平台

对于当今的大型设计，在实现阶段会生成大量数据。如果没有一个通用的数据库，工具必须通过 ASCII 设计交换文件进行通信，这会带来一系列问题，包括文件过大和传输时间过长、由于语义不匹配导致的错误，以及不同工具之间数据格式修订不一致。

Milkyway 数据库解决了 Galaxy 平台的这些问题，因为所有实现工具都可以直接通过二进制接口访问数据库。直接访问数据库消除了大型、缓慢的 ASCII 交换文件和不同工具功能之间的语义差距。每个工具都能以相同的方式查看数据，从而防止代价高昂的错误并减少设计迭代。

以下 Synopsys 工具使用 Milkyway 数据库：

- Design Compiler 使用 write_milkyway 命令将映射的、唯一化的设计写入 Milkyway 数据库，包括网表和综合约束。如果有的话，它还会写入 Synopsys 物理指导信息。它还可以将设计写成其他格式，如 .ddc 和 Verilog。
- IC Compiler 从 Milkyway 数据库读取物理设计信息和库单元信息，以执行布局、时钟树综合和布线。它将生成的芯片设计信息写回 Milkyway 数据库。
- Milkyway Environment 工具 从其他格式的物理数据（包括 GDSII、OASIS 和 LEF/DEF）准备新的库单元，并将新的库单元写入 Milkyway 数据库。Milkyway Environment 工具还可以用于复制、编辑和删除单元；以及执行阻塞、引脚和过孔（BPV）提取以生成 FRAM 视图。
- IC Validator 从 Milkyway 数据库读取物理设计信息，以执行设计规则检查（DRC）、电气规则检查（ERC）、版图与原理图一致性检查（LVS）和填充图案生成。它将结果写回数据库，以供 IC Compiler 读取和用于错误报告。
- PrimeRail 从 Milkyway 数据库中的 CEL 和 FRAM 视图读取物理设计数据，以执行 IR 压降和电迁移分析。在某些情况下，它从 CONN 视图读取连接信息。
- StarRC 从 Milkyway 数据库读取物理设计信息，以执行寄生 RC 提取。它将结果写回数据库，以供 IC Compiler 读取和用于时序和串扰分析。
- 旧工具 如 JupiterXT™、Astro® 和 Hercules™ 以类似于相应当前工具的方式使用 Milkyway 数据库。

有关使用 Synopsys 工具与 Milkyway 数据库的详细信息，请参阅 SolvNet 上提供的各个工具的文档。Milkyway Environment 工具可用于 Milkyway 库的维护和库单元的准备，具体描述见 SolvNet 上 IC Compiler 文档集中的《IC Compiler User Guide》的《Library Data Preparation》部分。

图 1 显示了使用 Milkyway 数据库的一些芯片设计和分析数据流。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../images/image-20241021144718683.png" width = "65%" alt=""/>
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">
      图1 Milkyway 数据库在Galaxy设计平台中的应用
  	</div>
</center>

<h3 id="1.2">1.2 Milkyway 数据库的版本</h3>

Milkyway 数据库基础设施会定期更新以支持新的数据库功能。每个新版本的数据库称为“模式”。

表 1 显示了每个新 Milkyway 模式对应的最早 IC Compiler 和 Milkyway Environment 产品版本号。

| IC Compiler和Milkyway Environment 版本 | Milkyway 模式                    |
| -------------------------------------- | -------------------------------- |
| J-2014.09                              | 8.1                              |
| H-2013.03                              | 7.0                              |
| F-2011.09                              | 6.0                              |
| D-2010.03-SP1                          | 5.1 (compatible with schema 5.0) |
| D-2010.03                              | 5.0                              |
| C-2009.06                              | 4.0                              |
| B-2008.09                              | 3.2                              |
| A-2007.12                              | 2.0                              |

当 IC Compiler 或 Milkyway Environment 版本 J-2014.09 读取存储在模式 7 或更早版本下的 Milkyway 数据时，工具会自动将数据更新到模式 8.1。存储在模式 8.1 下的 Milkyway 数据与 IC Compiler 和 Milkyway Environment 版本 I-2013.12-SP3 及更高版本兼容。例如，IC Compiler 版本 I-2013.12-SP3 可以读取和更新存储在模式 8.1 下的 Milkyway 数据。然而，早于该版本的工具（如 IC Compiler 版本 I-2013.12）无法读取模式 8.1 数据。模式 8.1 数据无法转换回早期模式。

表 2 列出了与 Milkyway 模式 8.1 兼容的 Synopsys 工具及其版本号。

| Synopsys Tool Name | Tool Releases that Support Milkyway Schema 8.1 |
|--------------------|-----------------------------------------------|
| Custom Designer    | J-2014.12 and later. I-2013.12-SP2 and later can read schema 8.1 data; J-2014.12 uses schema 8.1 by default. |
| Design Compiler    | J-2014.09 and later. I-2013.12-SP4 and later can read schema 8.1 abstraction models. |
| Formality          | I-2013.12-SP4 and later |
| IC Compiler        | J-2014.09 and later. I-2013.12-SP3 through I-2013.12-SP5 can read and write both schema 7 and schema 8.1 data. |
| IC Validator       | I-2013.12-SP2-1 and later |
| PrimeRail          | I-2013.12-SP3 and later for the default layer mode; support for the extended layer mode is planned for a future release |
| PrimeTime suite    | J-2014.06 and later |
| StarRC             | I-2013.12-SP3-1 and later; writes PARA data but not CEL data; no implicit conversion |
| TetraMAX ATPG      | J-2014.09 and later; reads X-Y coordinates of cell nets and topologies only |

注意： 最新版本的 Hercules 和 PrimeYield LCC 使用模式 5。没有计划更新 Astro 或 JupiterXT 的 Milkyway 数据库支持。MVRC（MVtools）和 Library Compiler 不使用 Milkyway 数据库。

你可以使用 IC Compiler 或 Milkyway Environment 工具中的 `convert_mw_lib` 命令，将 Milkyway 单元和库从以前的模式显式转换为当前的 Milkyway 模式。

如果你没有显式转换数据，当你使用最新版本的工具打开 Milkyway 单元时，工具会自动转换该单元并发出转换消息。你应该在关闭库之前保存转换后的单元。否则，当你重新打开该单元时，需要再次进行转换。

使用 `convert_mw_lib` 命令可以确保你的库数据完全转换，并且比逐个转换单元更高效。有关更多信息，请参阅《Library Data Preparation for IC Compiler User Guide》中的“Milkyway Database Versions”部分。

<h3 id="1.3">1.3 Milkyway 库和单元</h3>

物理库包含有关设计中放置的单元几何形状的信息，并与电源、地、时钟和信号线路连接。该库信息包括单元尺寸、边界、引脚位置和掩模层，以及技术信息，如布线轨迹、天线规则和电迁移数据。

物理库信息保存在 Milkyway 数据库中。Synopsys 工具可以访问数据库中的设计和库信息。数据库不仅包含叶级物理单元信息和技术信息，还包含设计特定的物理信息，如设计的布局和布线。

Milkyway 数据库组织为数据文件的层次结构。然而，你不能直接使用操作系统命令（如 cp 和 rm）创建、删除、复制或编辑这些文件。相反，你应该使用兼容的工具（如 IC Compiler 或 Milkyway Environment）并使用工具命令读取、写入或更改数据库内容。这确保了数据库的一致性和完整性。

在 Design Compiler、IC Compiler 或 Milkyway Environment 工具中，你可以使用 `open_mw_lib` 命令打开 Milkyway 数据库以进行查看或编辑。默认情况下，打开 Milkyway 库会使该库对工具可读写物理设计信息。一次只能打开一个 Milkyway 设计库。然而，设计可以包含对其他 Milkyway 库中单元的引用，这些库称为参考库。多个用户可以在不同的会话中打开同一个设计库。然而，一次只有一个用户可以获得写入 Milkyway 设计库的权限。

在 Milkyway 库中，基本的信息单位是单元（Cell）。单元是芯片布局中物理结构的表示，可以是简单的 I/O pad，也可以是整个芯片这样的大型复杂结构。在 IC Compiler 或 Milkyway Environment 工具中，你可以使用 `open_mw_cel` 命令打开单元进行编辑。该单元必须包含在当前打开的 Milkyway 库中。

芯片设计通常构建为单元的层次结构。整个芯片是由低级块构建的单个单元，这些块也是单元。这些块由更小的块构建，依此类推，直到叶级单元，即门级标准单元。

<h4 id="1.3.1">1.3.1 Cell Views</h4>

Milkyway 数据库可以包含同一单元的不同表示，称为该单元的“视图”。以下是物理实现工具中使用的主要视图类型：

- CEL 视图：物理结构（如过孔、标准单元、宏单元或整个芯片）的完整布局视图；包含单元的布局、布线、引脚和网表信息。
- FRAM 视图：用于布局和布线的单元抽象表示；仅包含单元的金属阻塞、允许的过孔区域和引脚。
- FILL 视图：金属填充视图，用于芯片完成，没有逻辑功能，由 IC Compiler 中的 `signoff_metal_fill` 命令创建。
- CONN 视图：单元的电源和地网络表示，由 PrimeRail 或 IC Compiler 工具创建，并由 PrimeRail 工具用于 IR 压降和电迁移分析。
- ERR 视图：IC Compiler 工具中验证命令（如 `verify_zrt_route` 或 `signoff_drc`）发现的物理设计规则违规的图形视图。

存储在 Milkyway 库中的物理设计必须至少有一个 CEL 视图，该视图包含布局、布线和掩模生成所需的所有单元信息。这包括布局信息，如tracks、site rows和placement blockage；布线信息，如网表、引脚、布线指南和互连建模信息，以及用于最终掩模生成的所有掩模层几何形状。

每个宏单元通常都有一个 CEL 视图和一个 FRAM 视图。FRAM 视图是单元的抽象表示，仅包含布局和布线所需的信息，包括单元边界、引脚位置、过孔着陆区和不允许布线的金属阻塞区。从 CEL 视图创建 FRAM 视图的过程称为blockage、pin和过孔（BPV）提取。

每个门级标准单元也可以有一个 CEL 视图和一个 FRAM 视图。FRAM 视图用于布局和布线，而 CEL 视图仅用于生成芯片制造的最终掩模数据流。

不要尝试使用操作系统命令（如 cp 或 rm）直接在 Milkyway 数据库中复制、编辑或删除单元视图文件。相反，应使用兼容的工具（如 IC Compiler 或 Milkyway Environment）来对单元视图进行任何更改。

过去，Milkyway 数据库用于存储逻辑、时序和功率数据文件在 LM、TIM 和 PWR 视图中。然而，这些类型的信息现在通常存储在 Milkyway 数据库之外维护的文件中，如 .db 文件。

<h4 id="1.3.2">1.3.2 设计库和参考库</h4>

Milkyway 数据库包含实现和分析工具所需的物理库信息。数据库不仅包含叶级物理单元信息和技术信息，还包含设计特定的物理信息，如布局和布线结果。芯片设计通常使用多个库，组织为设计库和参考库的层次结构。

你打开进行编辑的 Milkyway 库称为设计库。一次只能打开一个设计库。一个库可以包含任意数量的单元。你可以同时打开和显示一个库中的多个单元。一个单元可以使用其他未打开库中的单元实例构建。这些其他库称为参考库。

在 Design Compiler、IC Compiler 或 Milkyway Environment 工具中，你可以使用 `open_mw_lib` 命令打开 Milkyway 设计库。在 IC Compiler 和 Milkyway Environment 工具中，你可以使用 `open_mw_cel` 命令打开该库中的单元进行编辑。

